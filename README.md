# 哔哩哔哩（bilibili.com）调整

一个简单的小脚本，主要是给自己用的。

为了方便开发，又将脚本完全重构了一遍，并添加了新功能，此为第三个版本。  
因脚本托管网站（如 greasyfork）不允许上传混淆后的代码，故该版本的发布将不再使用脚本托管网站。  
目前第二个版本 [哔哩哔哩（bilibili.com）播放页调整](https://greasyfork.org/zh-CN/scripts/493405-%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9-bilibili-com-%E8%B0%83%E6%95%B4) 依然可用，但将不再更新。

相比第二个版本，此版本有以下可感知的更新： 
1. 常用功能重构，在性能和样式两个方面；
2. 脚本设置项不再依赖篡改猴等脚本插件，在支持设置的页面将显示设置开关；
3. 视频评论区新增「IP属地」显示；
4. 脚本托管在本人自己的网站，为方便使用，新增支持自动检查更新并弹窗提醒；

**本人用空闲时间陆陆续续改完，修修补补使用了几个月到现在暂未发现有什么问题，但是并不能保证一定没问题，若使用中发现问题请提出来，我会尽快处理**

请在浏览器安装诸如 [Tampermonkey](https://www.crxsoso.com/webstore/detail/dhdgffkkebhmkfjojejmpbldmpobfkfo), [Violentmonkey](https://www.crxsoso.com/webstore/detail/jinjaccalgkegednnccohejagnlnfdag), [ScriptCat](https://www.crxsoso.com/webstore/detail/ndcooeababalnlpkfedmmbbbgkljhpjf)  脚本引擎扩展后点击下方按钮在线安装，脚本引擎会自动弹出安装页面；  
以上扩展安装地址使用了油小猴的 [crxsoso](https://www.crxsoso.com) 源，如不放心可在浏览器扩展页面自行搜索安装。

安装地址：[在线安装](https://www.asifadeaway.com/bilibili/bilibili-adjustment.user.js) 

##  以下为第二版

Github: [哔哩哔哩（bilibili.com）播放页调整](https://github.com/QIUZAIYOU/Bilibili-Adjustment-Archived)

本脚本是对本人已发布的两个脚本：[哔哩哔哩（bilibili.com）播放页调整](https://greasyfork.org/zh-CN/scripts/415804-%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9-bilibili-com-%E6%92%AD%E6%94%BE%E9%A1%B5%E8%B0%83%E6%95%B4) 和 [哔哩哔哩（bilibili.com）动态页优化](https://greasyfork.org/zh-CN/scripts/40295-%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9-bilibili-com-%E5%8A%A8%E6%80%81%E9%A1%B5%E4%BC%98%E5%8C%96) 的整合。  

本脚本对以上两个脚本进行了完全的重构，并添加了部分新功能。

本脚本目前拥有功能如下：

视频会静音为浏览器安全行为，与本脚本无关，在浏览器地址栏左侧(不同浏览器位置及展现方式可能不同)网站权限中选择“允许音频和视频”即可。

一、通用调整：
1. ~~自动签到(登录即可)；~~(B站官方已下线签到功能)
2. 首页新增推荐视频历史记录(仅记录前6个推荐位中的非广告内容)，以防误点刷新错过想看的视频。  

二、动态页调整：
1. 默认显示"投稿视频"内容，可自行设置URL以免未来URL发生变化。  

三、播放页调整：
1. 自动定位到播放器（进入播放页，可自动定位到播放器，可设置偏移量及是否在点击主播放器时定位）；
2. 可设置播放器默认模式；
3. 可设置是否自动选择最高画质；
4. 新增快速返回播放器漂浮按钮；
5. 新增点击评论区时间锚点可快速返回播放器；
6. 网页全屏模式解锁(网页全屏模式下可滚动查看评论，并在播放器控制栏新增快速跳转至评论区按钮)；
7. 将视频简介内容优化后插入评论区或直接替换原简介区内容(替换原简介中固定格式的静态内容为跳转链接)；(已修复)
8. 视频播放过程中跳转指定时间节点至目标时间节点(可用来跳过片头片尾及中间广告等)；【只是说实现了这么个功能，但是由于并没有付费云数据库支撑，并不能保证使用效果】
9. 新增点击视频合集、下方推荐视频、结尾推荐视频卡片快速返回播放器；
10. 离开页面自动暂停视频，返回自动播放。
11. 新增自动开启字幕功能并添加快速开关。

### 历史更新

### 2025

`02.13 23:01`：修复「点击评论区时间锚点」返回至播放器失效的问题

`02.12 15:01`：修复「网页全屏解锁」后「插入跳转评论按钮」点击失效的问题

`01.31 19:23`：优化「定位至播放器」功能执行逻辑，并默认开启解锁合集/选集视频集数选择按钮功能；

`01.26 11:20`：修复「视频简介优化」及「点击评论区时间锚点可快速返回播放器」功能；

### 2024

`10.20 21:07`：修复点击视频结尾推荐视频不自动定位的问题；

`10.17 20:37`：新增自动开启字幕功能并添加快速开关；修复失效的函数；

`06.17 19:25`：修复「视频简介优化」功能因 VUE 版本号更新导致的样式错误问题。

`05.16 22:25`：优化「首页」推荐视频历史记录功能。

## 以下为第一版

Github: [哔哩哔哩（bilibili.com）播放页调整](https://github.com/QIUZAIYOU/Bilibili-VideoPage-Adjustment)、[哔哩哔哩（bilibili.com）动态页调整](https://github.com/QIUZAIYOU/Bilibili-DynamicPage-Adjustment) 

因最初没考虑太细，分为了 [哔哩哔哩（bilibili.com）播放页调整](https://greasyfork.org/zh-CN/scripts/415804-%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9-bilibili-com-%E6%92%AD%E6%94%BE%E9%A1%B5%E8%B0%83%E6%95%B4) 和 [哔哩哔哩（bilibili.com）动态页优化](https://greasyfork.org/zh-CN/scripts/40295-%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9-bilibili-com-%E5%8A%A8%E6%80%81%E9%A1%B5%E4%BC%98%E5%8C%96) 两个脚本开发。

### 历史更新

### 2024

`01.26 22:36`：优化「自动选择最高画质」功能逻辑，增加对勾选 「是否包含4K」或「是否包含8K」选项，但视频本身没有提供这两个清晰度选项的情况的处理，此时将自动勾选除这两项之外的最高画质。

`01.24 20:52`：修复开启「网页全屏模式解锁」功能后，网页全屏状态下按某些顺序切换至其他模式会导致页面错乱的问题。

`01.22 09:45`：修复因 `01.17 09:48` 更新，误把「自动选择播放器默认模式」功能关闭状态的检测逻辑删除，在功能关闭状态下脚本错误反复尝试切换播放器模式导致页面闪烁的问题。

`01.21 21:07`：修复因播放页代码变动导致的「自动选择最高画质」功能失效的问题。

`01.19 18:30`：修复开启「网页全屏解锁」功能后错误循环执行「自动定位至播放器」的问题。[#2](https://github.com/QIUZAIYOU/Bilibili-VideoPage-Adjustment/issues/2)

`01.19 17:57`：增加检查视频是否处于可播放状态的次数。

`01.17 09:48`：优化代码，移除代码中已失效的部分。

`01.09 21:14`：修复「bangumi」页面右侧漂浮导航插入「自动定位至播放器」按钮失效的问题。

`01.09 11:10`：修复「bangumi」页面播放「电影」类型视频时自动选择「播放器默认模式」失败的问题。设置中新增「脚本执行失败自动刷新重试」选项。

### 2023

`12.28 20:20`：适配最新的「bangumi」页面代码，修复「自动定位至播放器」及「点击播放器自动定位至播放器」错位的问题，其他积累问题修复。

`11.14 20:58`：调整「自动定位至播放器」判定条件，提高定位成功率。

`11.11 21:49`：修复「bangumi」播放页自动选择「播放器默认模式」失败的问题。

`11.11 20:59`：修复因数字精度问题导致「自动定位至播放器」功能失效的问题。

`07.04 08:10`：修复因一行调试代码未注释导致火狐浏览器中脚本报错不执行的问题。

`06.19 23:23`：设置中新增「播放器默认模式」选项，可选择关闭。

`06.18 14:37`：重构后代码重新加入浏览器标签页激活状态检测，调整设置将在当前标签页激活时应用。

`04.08 14:21`：优化对「video」播放页新版网页结构的适配。

`04.01 23:41`：重构代码，优化脚本，适配「video」播放页新版网页结构。

`02.26 21:50`：设置中新增「自动定位至播放器」选项，可自由选择在「video」或「bangumi」类型播放页中开启本功能。默认全部开启。

`02.13 22:55`：修复点击浏览器前进后退按钮后「自动定位至播放器」功能不生效的问题。

`02.11 22:11`：修复点击「bangumi」播放页「时间锚点」自动定位至播放器功能失效的问题。

`02.11 20:37`：修复点击新加载评论中的「时间锚点」自动定位至播放器功能失效的问题。

`02.10 19:25`：修复因 `02.10 16:29` 更新覆盖评论区「时间锚点」原有功能导致的视频播放进度不跳转的问题。

`02.10 16:29`：新增点击评论区「时间锚点」自动定位至播放器功能。

`02.08 22:28`：1.优化代码，修复部分函数会重复执行的问题。2.「网页全屏模式解锁」功能开启状态下视频控制条「进入全屏」按钮旁新增「前往评论」按钮，可点击此按钮直达评论区，避免滚动鼠标滚轮出现调整音量提示。

`02.08 09:52`：适配「稍后再看」视频播放页面。

### 2022

`10.14 11:40`：开启「网页全屏模式解锁」功能后，下滑新增迷你播放器显示，不过比较简陋，只支持暂停/播放操作，有条件的建议还是直接使用浏览器自带的小窗播放功能。

`10.14 09:53`：修复开启「自动选择最高画质」功能后，未勾选 「是否包含4K」及「是否包含8K」的情况下错误选择 8K 画质的问题。

`10.11 20:45`：修复开启「网页全屏模式解锁」功能后，网页全屏状态下切换其他模式页面错乱的问题。

`09.30 23:00`：新增「网页全屏模式解锁」功能，网页全屏模式下可以滑动滚动条查看下方评论等内容（因bangumi播放页网页全屏时下方评论仍未加载所以暂不支持），需在设置里重新勾选播放器默认模式并保存后生效（如不生效多保存几次并清除浏览器缓存试试）。

`09.30 10:10`：重构部分代码，修复积累问题。

`08.09 09:15`：修复「自动选择最高画质」功能「是否包含4K」的问题。

`08.08 17:00`：加入浏览器标签页激活状态检测，调整设置将在当前标签页激活时应用。

`08.02 20:56`：适配新版播放页改动。

`07.18 10:16`：尝试修复「自动定位至播放器」概率失效的问题。

`07.15 16:27`：尝试修复自动选择「播放器默认模式」概率失效的问题。

`07.09 22:50`：修复「自动定位至播放器」会在首次定位成功后重复执行的问题。
